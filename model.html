<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>3D Модель Скорпиона | Mortal Kombat X</title>
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    #model-container {
      width: 100%;
      height: 60vh;
      background: #000;
      margin: 20px 0 30px;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }
    #loading, #error, #instructions {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      color: white;
      padding: 20px;
      background: rgba(0,0,0,0.8);
      border-radius: 8px;
      max-width: 90%;
    }
    #getOverHere {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3.5rem;
      font-weight: 900;
      color: var(--primary);
      text-shadow: 0 0 20px rgba(230, 43, 43, 0.9);
      opacity: 0;
      pointer-events: none;
      z-index: 20;
    }
    @keyframes chainPull {
      0% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
      10% { opacity: 1; }
      50% { transform: translate(-50%, -50%) scale(1.3); }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Главная</a></li>
        <li><a href="model.html" class="active">3D Модель</a></li>
        <li><a href="lore.html">История</a></li>
        <li><a href="gallery.html">Галерея</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="container">
      <h1>3D МОДЕЛЬ СКОРПИОНА</h1>

      <div id="model-container">
        <div id="loading">Загрузка модели из ада...</div>
        <div id="error" style="display:none;">
          ❌ Ошибка загрузки модели.<br>
          Убедитесь, что вы запускаете сайт через локальный сервер (см. README.txt)
        </div>
        <div id="instructions" style="display:none;">
          Нажмите на модель, чтобы услышать легендарную фразу!
        </div>
        <div id="getOverHere">GET OVER HERE!</div>
      </div>

      <h2>Как использовать</h2>
      <p>• На ПК: вращайте модель мышью, колёсиком — масштаб</p>
      <p>• На телефоне: перетаскивайте пальцем, щипок — масштаб</p>
      <p>• Клик/тап — проиграть фразу Скорпиона</p>
    </div>
  </main>

  <footer>
    &copy; 2026 Mortal Kombat Fan Site. Неофициальный проект.
  </footer>

  <script type="module">
    // Проверка: запущен ли через сервер?
    if (window.location.protocol === 'file:') {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error').innerHTML = 
        '⚠️ Сайт запущен локально!<br>' +
        'Чтобы 3D-модель работала, откройте его через веб-сервер.<br>' +
        'См. инструкцию в README.txt';
      throw new Error('Запустите через сервер!');
    }

    import * as THREE from 'https://unpkg.com/three@0.160.1/build/three.module.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.160.1/examples/jsm/loaders/GLTFLoader.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.1/examples/jsm/controls/OrbitControls.js';

    const container = document.getElementById('model-container');
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const instructionsEl = document.getElementById('instructions');

    let scene, camera, renderer, controls, model;

    // Сцена
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050505);
    scene.fog = new THREE.Fog(0x050505, 10, 30);

    // Камера
    camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.set(0, 1, 5);

    // Рендерер
    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // Контролы
    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;
    controls.screenSpacePanning = false;
    controls.minDistance = 2;
    controls.maxDistance = 10;

    // Свет
    const ambient = new THREE.AmbientLight(0x333333);
    scene.add(ambient);

    const keyLight = new THREE.DirectionalLight(0xff5522, 1.5);
    keyLight.position.set(5, 8, 5);
    scene.add(keyLight);

    const fillLight = new THREE.DirectionalLight(0x2255ff, 0.3);
    fill_light.position.set(-5, -3, -5);
    scene.add(fillLight);

    // Загрузка модели
    const loader = new GLTFLoader();
    loader.load(
      'assets/scorpion.glb',
      (gltf) => {
        model = gltf.scene;
        model.traverse(child => {
          if (child.isMesh) {
            child.castShadow = true;
            child.receiveShadow = true;
          }
        });
        model.position.y = -1;
        scene.add(model);

        loadingEl.style.display = 'none';
        instructionsEl.style.display = 'block';
      },
      undefined,
      (error) => {
        console.error('Ошибка загрузки GLB:', error);
        loadingEl.style.display = 'none';
        errorEl.style.display = 'block';
      }
    );

    // Клик — фраза
    renderer.domElement.addEventListener('pointerdown', () => {
      if (!model) return;
      const text = document.getElementById('getOverHere');
      text.style.animation = 'none';
      setTimeout(() => {
        text.style.animation = 'chainPull 1.2s forwards';
      }, 10);
    });

    // Анимация
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // Респонсив
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    });
  </script>
</body>
</html>